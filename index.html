let socket = new WebSocket("wss://your-render-app.onrender.com");

socket.onmessage = (event) => {
    let data = JSON.parse(event.data);

    if (data.type === "users") {
        updateMapPins(data.users);
    }
};

function sendLocationUpdate(lat, lon, pic) {
    socket.send(JSON.stringify({
        type: "updateLocation",
        username: document.getElementById("username").value,
        lat,
        lon,
        pic,
    }));
}

function updateMapPins(users) {
    for (let user in users) {
        let userData = users[user];
        let size = Math.max(10, map.getZoom() * 3);
        let imgSize = Math.max(5, map.getZoom() * 2);

        let marker = L.marker([userData.lat, userData.lon], {
            icon: L.divIcon({
                className: "custom-pin",
                html: `<div style='background:#ffcc00;border-radius:50%;width:${size}px;height:${size}px;text-align:center;line-height:${size}px;'><img src='${userData.pic || ''}' width='${imgSize}px' height='${imgSize}px' style='border-radius:50%;'></div>`
            }),
        });

        marker.addTo(map);
    }
}

navigator.geolocation.watchPosition((position) => {
    sendLocationUpdate(position.coords.latitude, position.coords.longitude, currentUser.pic);
});
